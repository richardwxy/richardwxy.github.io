<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>全景图开发测试</title>
    <style>
        *{overflow: hidden;margin:0;padding:0;}
        canvas {
            width: 100%;
            height: 100%;
        }
        p{background-color: transparent;color: #EEEEEE}
    </style>
    <script type="text/javascript" src="http://cdn.bootcss.com/three.js/r82/three.min.js"></script>
    <script src="OrbitControls.js"></script>
</head>
<body style="background-color: #000000">

<p>左右：<span id="alpha">0</span>
</p>
<p>前后：<span id="beta">0</span>
</p>
<p>扭转：<span id="gamma">0</span>
</p>
<!--<p>指北针指向：<span id="heading">0</span>度</p>-->
<!--<p>指北针精度：<span id="accuracy">0</span>度</p>-->
<!--<hr />-->
<!--<p>x轴加速度：<span id="x">0</span>米每二次方秒</p>-->
<!--<p>y轴加速度：<span id="y">0</span>米每二次方秒</p>-->
<!--<p>z轴加速度：<span id="z">0</span>米每二次方秒</p>-->
<!--<hr />-->
<!--<p>x轴加速度(考虑重力加速度)：<span id="xg">0</span>米每二次方秒</p>-->
<!--<p>y轴加速度(考虑重力加速度)：<span id="yg">0</span>米每二次方秒</p>-->
<!--<p>z轴加速度(考虑重力加速度)：<span id="zg">0</span>米每二次方秒</p>-->
<!--<hr />-->
<!--<p>左右旋转速度：<span id="Ralpha">0</span>度每秒</p>-->
<!--<p>前后旋转速度：<span id="Rbeta">0</span>度每秒</p>-->
<!--<p>扭转速度：<span id="Rgamma">0</span>度每秒</p>-->
<!--<hr />-->
<!--<p>上次收到通知的间隔：<span id="interval">0</span>毫秒</p>-->


<script>


    (function () {
        var index = (function () {
            var scene, camera, renderer, controls,
                    renderCount = 0;

            return {
                init: function () {
                    index.initScene();
                    //添加事件
                    index.addEvent();
                    //执行
                    index.render();
                    index.animate();
                    index.initMotion();

                },



                initScene: function () {
                    scene = new THREE.Scene();
                    var ext = '.png'
                            , textureCube = new THREE.CubeTextureLoader()
                                    .setPath('')
                                    .load([
                                        'px' + ext,
                                        'nx' + ext,
                                        'py' + ext,
                                        'ny' + ext,
                                        'pz' + ext,
                                        'nz' + ext
                                    ]);
                    scene.background = textureCube;
                    //加入环境光,浅灰色
                    scene.add(new THREE.AmbientLight(0xffffff));

                    index.initCamera();
                    index.initRenderer();
                    index.initControls();
                },
                initCamera: function () {
                    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
                    camera.position.set(200, 200, 200);
                    camera.lookAt(scene.position);
                    console.log(scene.position);
                    scene.add(camera);
                },
                initRenderer: function () {
                    renderer = new THREE.WebGLRenderer();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    document.body.appendChild(renderer.domElement);
                },
                initControls:function(){
                    controls = new THREE.OrbitControls(camera);
                    controls.addEventListener('change', index.render);
                    controls.autoRotate = false;//自动旋转开关
                    controls.autoRotateSpeed = 2;
                },
                addEvent:function(){
                    window.addEventListener('resize', index.windowResize, false);
                    function onBorderMouseUp(ev) {
                        window.addEventListener("drag", function(){alert('drag')});
                    }
                    onBorderMouseUp();
                },
                render: function () {
                    renderer.render(scene, camera);
                },
                animate: function () {
                    if (renderCount === 0) {
                        index.render();
                    }
                    requestAnimationFrame(index.animate);
                    controls.update();
                },
                initMotion:function(){
                    if (window.DeviceOrientationEvent) {
                        window.addEventListener("deviceorientation", orientationHandler, false);
                    } else {
                        alert("What user agent u r using");
                    };


                    function orientationHandler(event) {
                        document.getElementById("alpha").innerHTML = event.alpha;
                        document.getElementById("beta").innerHTML = event.beta;
//                        render(event.alpha,event.beta);
                        var ev  = document.createEventObject("TouchMove");
                        event.eventType = 'touchmove';
                        ev.touches[0].pageX=event.alpha*window.innerWidth/90;
                        ev.touches[0].pageY=event.beta*window.innerHeight/90;
                        window.dispatchEvent(ev);


                        var newEvt = document.createEvent("MouseEvents");
                        var type = null;
                        var touch = null;
                        event.touches[0].pageX=event.alpha*window.innerWidth/90;
                        event.touches[0].pageY=event.beta*window.innerHeight/90;
//                        switch (event.type) {
//                            case "touchstart": type = "mousedown"; touch = event.changedTouches[[0];
                              type = "mousemove"; touch = event.touches;
//                            case "touchend":   type = "mouseup"; touch = event.changedTouches[0];
//                        }
                        newEvt.initMouseEvent(type, true, true, event.originalTarget.ownerDocument.defaultView, 0,
                                touch.screenX, touch.screenY, touch.clientX, touch.clientY,
                                evt.ctrlKey, evt.altKey, evt.shirtKey, evt.metaKey, 0, null);
                        event.originalTarget.dispatchEvent(newEvt);

                    }
//                    function render(detX,detY) {
//
//                        var timer = -0.0002 * Date.now();
//
////            pointLight.position.x = 1500 * Math.cos( timer );
////            pointLight.position.z = 1500 * Math.sin( timer );
//
//                        camera.position.x += (detX - camera.position.x ) ;
//                        camera.position.y += ( - detY - camera.position.y ) ;
//
//                        camera.lookAt( scene.position );
//
//                        renderer.render( scene, camera );
//
//                    }

                },
                windowResize:function(){
                    console.log(new Date());
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();

                    renderer.setSize(window.innerWidth, window.innerHeight);
                    controls.reset();
                    index.render();
                }
            };
        })();

        index.init();
    })();
    window.onload = function(){


//
//        function motionHandler(event) {
//            document.getElementById("interval").innerHTML = event.interval;
//            var acc = event.acceleration;
//            document.getElementById("x").innerHTML = acc.x;
//            document.getElementById("y").innerHTML = acc.y;
//            document.getElementById("z").innerHTML = acc.z;
//            var accGravity = event.accelerationIncludingGravity;
//            document.getElementById("xg").innerHTML = accGravity.x;
//            document.getElementById("yg").innerHTML = accGravity.y;
//            document.getElementById("zg").innerHTML = accGravity.z;
//            var rotationRate = event.rotationRate;
//            document.getElementById("Ralpha").innerHTML = rotationRate.alpha;
//            document.getElementById("Rbeta").innerHTML = rotationRate.beta;
//            document.getElementById("Rgamma").innerHTML = rotationRate.gamma;
//        }



//        if (window.DeviceMotionEvent) {
//            window.addEventListener("devicemotion", motionHandler, false);
//        } else {
//            alert("What user agent u r using");
//        }


    };

</script>
</body>